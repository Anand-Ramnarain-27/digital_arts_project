<meta name="monetization" content="$twitter.xrptipbot.com/remvst"><title>My Game</title><style>/* *{margin:0;width:100%;height:100%;background:#000;position:relative}#t{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}#g{display:block} */</style><div id="t"><canvas id="g"></canvas></div><script>function revertOptimizeMatrix(t,e,i){const a=[],s=Array(e).fill(1);a.push(s);for(let i=0;i<t-2;i++){const t=[];t.length=e,t[0]=1,t[e-1]=1,a.push(t)}return a.push(s),i.forEach(t=>{let[e,i,s,l]=t,r=!!s,n=!!l;for(let t=0;t<max(s,l);t++)a[e+t*r][i+t*n]=1}),a}let R,G,W,P,w=window,onMenu=1,CANVAS=g;limit=((t,e,i)=>e<t?t:e>i?i:e),between=((t,e,i)=>e>=t&&e<=i),rnd=((t,e)=>random()*(e-t)+t),pick=(t=>t[~~(random()*t.length)]),distP=((t,e,i,a)=>sqrt(pow(t-i,2)+pow(e-a,2))),dist=((t,e)=>distP(t.x,t.y,e.x,e.y)),normalize=(t=>moduloWithNegative(t,PI)),angleBetween=((t,e)=>atan2(e.y-t.y,e.x-t.x)),roundToNearest=((t,e)=>round(t/e)*e),moduloWithNegative=((t,e)=>((t%=2*e)>e&&(t-=2*e),t<-e&&(t+=2*e),t));let math=Math;Object.getOwnPropertyNames(math).forEach(t=>w[t]=w[t]||math[t]),TWO_PI=2*PI;let canvasProto=CanvasRenderingContext2D.prototype;canvasProto.wrap=function(t){this.save(),t(),this.restore()},canvasProto.fr=canvasProto.fillRect,canvasProto.fs=function(t){this.fillStyle=t},canvasProto.roundedRectangle=function(t,e,i,a,s){PI;let l=2*PI/2,r=2*PI/4;this.arc(s+t,s+e,s,-r,l,1),this.arc(s+t,a-s+e,s,l,r,1),this.arc(t+i-s,e+a-s,s,r,0,1),this.arc(t+i-s,e+s,s,0,-r,1)},onresize=(()=>{var e,i,a=innerWidth,s=innerHeight,l=a/s,r=t.style;l<=2?i=(e=a)/2:e=2*(i=s),r.width=e+"px",r.height=i+"px"}),linear=(t=>t),easeOutQuad=(t=>t*(2-t)),easeOutQuint=(t=>1+--t*t*t*t*t),easeInQuint=(t=>t*t*t*t*t),easeInOutCubic=(t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1),interp=((t,e,i,a,s,l,r,n)=>{let h={o:t,p:e,a:i,b:a,d:s,l:l||0,f:r||linear,e:n||(()=>0),t:0,cycle:t=>{if(h.l>0)h.l-=t,h.o[h.p]=h.a;else if(h.t=min(h.d,h.t+t),h.o[h.p]=h.f(h.t/h.d)*(h.b-h.a)+h.a,h.t==h.d){h.e();let t=INTERPOLATIONS.indexOf(h);t>=0&&INTERPOLATIONS.splice(t,1)}}};INTERPOLATIONS.push(h)}),INTERPOLATIONS=[],castRay=((t,e,i,a)=>{let s,l=castAgainstHorizontal(t,e,i,a),r=castAgainstVertical(t,e,i,a);if(l)if(r){s=distP(t,e,l.x,l.y)<distP(t,e,r.x,r.y)?l:r}else s=l;else s=r;return distP(t,e,s.x,s.y)>a&&(s={x:t+cos(i)*a,y:e+sin(i)*a}),s}),castAgainstHorizontal=((t,e,i,a)=>{var s=sin(i)>0,l=40*~~(e/40)+(s?40:-1e-4),r=t+(l-e)/tan(i),n=s?40:-40,h=n/tan(i);return doCast(r,l,h,n,1,a)}),castAgainstVertical=((t,e,i,a)=>{var s=cos(i)>0,l=40*~~(t/40)+(s?40:-1e-4),r=e+(l-t)*tan(i),n=s?40:-40,h=n*tan(i);return doCast(l,r,n,h,0,a)}),doCast=((t,e,i,a,s,l)=>{let r=t,n=e;for(let h=0;distP(r,n,t,e)<l;h++){if(internalHasBlock(r,n)){let t=~~(r/40)+~~(n/40)*G.level.definition.matrix.length;return{x:r,y:n,castType:s+"-"+t,blockId:t}}if(isOut(r,n))break;r+=i,n+=a}return{x:r,y:n,castType:""}}),hasBlock=((t,e,i=0)=>internalHasBlock(t,e)||internalHasBlock(t-i,e-i)||internalHasBlock(t-i,e+i)||internalHasBlock(t+i,e-i)||internalHasBlock(t+i,e+i)),internalHasBlock=((t,e)=>!isOut(t,e)&&G.level.definition.matrix[~~(e/40)][~~(t/40)]),isOut=((t,e)=>!between(0,t,40*G.level.definition.matrix[0].length-1)||!between(0,e,40*G.level.definition.matrix.length-1)),toCellUnit=(t=>~~(t/40)),toMiddleCellCoord=(t=>40*(t+.5)),remove=((t,e)=>{let i=t.indexOf(e);i>=0&&t.splice(i,1)});class PointRenderable{constructor(t,e,i,a){this.x=t,this.y=e,this.radius=i,this.color=a}render(){R.fillStyle=this.color,fr(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}createNumberGenerator=(t=>{let e=new Uint32Array([imul(t,2246822507),imul(t,3266489909)]),i=()=>{let t=e[0],i=e[1]^t;return e[0]=(t<<26|t>>8)^i^i<<9,e[1]=i<<13|i>>19,(imul(t,2654435771)>>>0)/4294967295};return{pick:t=>t[~~(i()*t.length)],between:(t,e)=>i()*(e-t)+t,floating:i}});let createCanvas=(t,e,i)=>{let a=document.createElement("canvas");return a.width=t,a.height=e,i(a.getContext("2d"),a)||a},createCanvasPattern=(t,e,i)=>{let a=createCanvas(t,e,i),s=a.getContext("2d").createPattern(a,"repeat");return s.width=t,s.height=e,s};padCanvas=((t,e,i,a)=>createCanvas(40*e,40*t,(t,e)=>{let s;s=e.height*i-a.height*i,t.drawImage(a,(e.width-a.width)/2,s)})),SKY_BACKGROUND=createCanvasPattern(200,800,t=>{let e=t.createLinearGradient(0,0,0,800);e.addColorStop(0,"#000"),e.addColorStop(.7,"#000"),e.addColorStop(1,"#000"),t.fillStyle=e,t.fr(0,0,200,800)}),GOD_RAY=createCanvas(24,160,(t,e)=>{let i=t.createLinearGradient(0,0,0,160);i.addColorStop(0,"rgba(255,255,255, 0)"),i.addColorStop(.5,"rgba(255,255,255, 0.5)"),i.addColorStop(1,"rgba(255,255,255, 0)"),t.fillStyle=i,t.fillRect(0,0,99,999)}),HALO=createCanvas(160,160,(t,e)=>{let i=t.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,e.width/2);i.addColorStop(.5,"rgba(255,255,255, 0.5)"),i.addColorStop(1,"rgba(255,255,255, 0)"),t.fillStyle=i,t.fillRect(0,0,999,999)}),COMPUTER=createCanvas(24,24,(t,e)=>{t.fillStyle="#000",t.fr(0,0,99,99),t.fillStyle="#a9a9a9",t.fr(2,2,e.width-4,e.height-4),t.fillStyle="#4253ff",t.fr(4,4,e.width-8,e.height-12),t.fillStyle="#000",t.fr(4,e.height-6,e.width-8,2),t.fillStyle="#a5dc40",t.fr(e.width-6,e.height-6,2,2)}),WINDOW_PATTERN=createCanvasPattern(80,80,(t,e)=>{t.fillStyle="#8c9bee",t.fillRect(0,0,999,999),t.fillStyle="#f29afb",t.fillRect(e.width/10,e.height/4,8*e.width/10,e.height/2)}),BUILDING_PATTERN=createCanvasPattern(800,320,(t,e)=>{t.fillStyle="#adbbff",t.fillRect(0,0,e.width,999),t.fillStyle=WINDOW_PATTERN,t.fillRect(0,10,e.width,e.height-20)}),SIGN_HOLDER_PATTERN=createCanvasPattern(80,80,(t,e)=>{t.fillStyle=t.strokeStyle="#111",t.lineWidth=4,t.fr(0,0,99,99),t.clearRect(4,4,e.width-8,e.height-8),t.beginPath(),t.moveTo(0,0),t.lineTo(99,99),t.moveTo(e.width,0),t.lineTo(0,e.height),t.stroke()}),createBuildingsBackground=((t,e)=>createCanvasPattern(400,e,(i,a)=>{i.fillStyle=t;let s=0;for(;s<a.width;){let t=~~rnd(80,120);i.fr(s,200*random(),t,e),s+=t}})),BUILDINGS_BACKGROUND=[createBuildingsBackground("#000",600),createBuildingsBackground("#000",500),createBuildingsBackground("#000",300)],UNPADDED_DESK=createCanvas(44,20,(t,e)=>{t.fillStyle="#000",t.fillRect(2,0,2,e.height),t.fillRect(e.width-2,0,-2,e.height),t.fillStyle="#494742",t.fillRect(0,0,99,4),t.fillStyle="#ccc",t.fillRect(4,4,e.width/4,e.height/3),t.fillRect(e.width-4,4,-e.width/4,e.height/3)}),DESK=padCanvas(1,2,1,UNPADDED_DESK),LEVEL_BACKGROUND=createCanvasPattern(160,240,(t,e)=>{t.fillStyle="#000",t.globalAlpha=.05,t.fr(0,0,e.width,2),t.fr(0,120,e.width,2),t.fr(0,0,2,120),t.fr(80,120,2,400)}),createLevelBackground=(t=>createCanvas(800,800,(e,i)=>{e.fillStyle=LEVEL_BACKGROUND,e.fr(0,0,i.width,i.height);let a=createNumberGenerator(1),s=t.definition.matrix.map(t=>t.slice());s[t.definition.exit[0]][t.definition.exit[1]]=1;for(let t=1;t<19;t++)for(let i=1;i<19;i++){if(s[t][i])continue;let l=l=>{if(!(a.floating()>.15)){for(let e=0;e<l.height/40;e++)for(let a=0;a<l.width/40;a++)if(s[t+e][i+a])return;for(let e=0;e<l.height/40;e++)for(let a=0;a<l.width/40;a++)s[t+e][i+a]=1;e.drawImage(l,40*i,40*t)}},r=(s[t][i],s[t][i+1]),n=s[t+1][i],h=(s[t-1][i],s[t+2]&&s[t+2][i],s[t+1][i+1]);n&&!r&&h&&l(DESK)}[].forEach(t=>{a.floating()<.15&&t()})}));class Particle{constructor(t){let e=t.duration||1;this.color=t.color||"#f00";let i=t.size||[5,5],a=t.alpha||[1,-1];interp(this,"x",t.x[0],t.x[0]+t.x[1],e),interp(this,"y",t.y[0],t.y[0]+t.y[1],e),interp(this,"alpha",a[0],a[0]+a[1],e),interp(this,"size",i[0],i[0]+(i[1]||0),e,0,0,t.onFinish)}render(){R.globalAlpha=this.alpha,fs(this.color),beginPath(),arc(this.x,this.y,this.size/2,0,TWO_PI),fill()}}class Menu{constructor(t,e){this.title=t,this.subtitle=e,this.titlePosition=this.subtitlePosition=9999,this.dimAlpha=0}animateIn(){interp(this,"titlePosition",-400,400,.5,0,easeOutQuint),interp(this,"subtitlePosition",1200,400,.5,1,easeOutQuint),interp(this,"dimAlpha",0,1,.3)}animateOut(){interp(this,"titlePosition",400,1200,.5,0,easeInQuint),interp(this,"subtitlePosition",400,-400,.5,0,easeInQuint,()=>G.menu=0),interp(this,"dimAlpha",1,0,.3,.2)}cycle(t){}render(){translate(400,0),beginPath(),rect(0,0,800,800),clip(),R.fillStyle="rgba(0,0,0,"+.8*this.dimAlpha+")",fr(0,0,800,800),R.textAlign="center",R.textBaseline="middle",R.fillStyle="#fff",R.font="italic 24pt Impact",fillText(this.title,this.titlePosition,375),R.font="italic 48pt Impact",fillText(this.subtitle,this.subtitlePosition,425)}}renderVision=((t,e,i,a,s,l)=>wrap(()=>{R.fillStyle=R.strokeStyle=l,R.lineWidth=2,R.globalAlpha=.3,beginPath(),moveTo(t,e);for(let l=0;l<=30;l++){let r=l/30*(a-i)+i;l&&l<30&&(r=roundToNearest(r,(a-i)/30));let n=castRay(t,e,r,s);lineTo(n.x,n.y)}closePath(),fill(),stroke()}));let legLength=6,visualRadius=17,bodyWidth=2*visualRadius-8,bodyHeight=2*visualRadius-4;createCharacterBody=(t=>createCanvas(bodyWidth,bodyHeight+legLength,(e,i)=>{e.fillStyle="#000",e.beginPath(),e.roundedRectangle(0,0,i.width,bodyHeight,6),e.fill(),e.globalCompositeOperation="source-atop",t(e,i)})),PLAYER_BODY=createCharacterBody((t,e)=>{t.fillStyle="#000",t.fr(e.width,6,-bodyWidth/2,4),t.fillStyle="#000",t.fr(0,bodyHeight-10,99,2)}),GUARD_BODY=createCharacterBody((t,e)=>{t.fillStyle="#FF0000",t.fr(0,0,99,99),t.fillStyle="#FF0000",t.fr(0,0,99,14),t.fillStyle="#FF0000",t.fr(0,25,99,99),t.fillStyle="#FF0000",t.fr(bodyWidth-6,14,2,10)}),renderPlayer=((t,e,i,a,s,l)=>{t.scale(a,1),wrap(()=>{s&&t.rotate(sin(G.clock*PI*2/.25)*PI/32),t.rotate(l*PI*2),t.translate(-e.width/2,-e.height/2),t.drawImage(e,0,0),renderEyes(t)}),i&&renderLegs(t,s)}),renderEyes=(t=>{t.fillStyle="#000";let e=G.clock%4,i=min(1,max(3.85-e,e-3.85)/.15);t.fr(bodyWidth-1,7,-2,2*i),t.fr(bodyWidth-5,7,-2,2*i)}),renderLegs=((t,e)=>{R.fillStyle="#000";let i=.5*sin(G.clock*PI*2/.25)+.5,a=e?i:1,s=e?1-i:1;t.fr(-8,visualRadius-legLength,4,a*legLength),t.fr(8,visualRadius-legLength,-4,s*legLength)});class Player{constructor(t,e,i){this.level=t,this.x=e,this.y=i,this.previous={},this.vX=this.vY=0,this.facing=1,this.walking=0,this.facingScale=1,this.jumpHoldTime=0,this.jumpReleased=1,this.jumpStartY=0,this.jumpEndY=0,this.jumpPeakTime=0,this.controllable=0,this.wasStickingToWallX=0,this.clock=0,this.bandanaTrail=[]}get landed(){let t=this.x-15,e=this.x+15,i=this.y+15+1;return hasBlock(t,i)||hasBlock(e,i)}get sticksToWall(){if(this.landed)return 0;this.wasStickingToWallX,this.x;let t=this.x-15-1,e=this.x+15+1;return hasBlock(t,this.y)&&(w.down[37]||this.wasStickingToWallX)?(this.wasStickingToWallX=this.x,1):hasBlock(e,this.y)&&(w.down[39]||this.wasStickingToWallX)?(this.wasStickingToWallX=this.x,-1):0}cycle(t){let e=t;do{let t=min(e,1/60);e-=t,this.subCycle(t)}while(e>0)}subCycle(t){this.previous.x=this.x,this.previous.y=this.y,this.previous.clock=this.clock,this.previous.facing=this.facing,this.previous.landed=this.landed,this.previous.jumpHoldTime=this.jumpHoldTime,this.clock+=t;let e=down[32]&&this.controllable;if(this.jumpReleased=this.jumpReleased||!e,e?this.jumpHoldTime+=t:this.jumpHoldTime=0,e&&this.jumpReleased&&(this.landed||this.sticksToWall)&&(this.jumpReleased=0,this.jumpStartY=this.y,this.jumpStartTime=this.clock,this.vX+=800*this.sticksToWall,this.vY=0),e&&!this.jumpReleased){let t=min(this.jumpHoldTime,.15)/.15,e=20+40*t*3;this.jumpPeakTime=.1+.2*t,this.jumpEndY=this.jumpStartY-e}if(this.clock<this.jumpStartTime+this.jumpPeakTime){let t=(this.clock-this.jumpStartTime)/this.jumpPeakTime;this.y=easeOutQuad(t)*(this.jumpEndY-this.jumpStartY)+this.jumpStartY}else{let e=this.sticksToWall&&this.vY>0?1e3:4e3;this.vY=max(0,this.vY+e*t),this.y+=this.vY*t}let i=0,a=0;this.controllable&&(down[37]&&(i=-1,a=-400),down[39]&&(i=1,a=400)),this.landed&&i&&(this.facing=i),this.facing!=this.previous.facing&&interp(this,"facingScale",-1,1,.1),this.walking=i;let s=this.landed?3e3:1500;for(this.vX+=limit(-s*t,a-this.vX,s*t),this.x+=this.vX*t,this.readjust(),this.bandanaTrail.unshift({x:this.x-5*this.facing,y:this.y-10+rnd(-1,1)});this.bandanaTrail.length>30;)this.bandanaTrail.pop();if(this.bandanaTrail.forEach(e=>e.y+=100*t),!this.landed&&!this.sticksToWall){let{x:t,y:e}=this,i=createCanvas(80,80,t=>{t.translate(40,40),this.renderCharacter(t)}),a={render:()=>{R.globalAlpha=a.alpha,drawImage(i,t-i.width/2,e-i.height/2)}};this.level.renderables.push(a),interp(a,"alpha",.1,0,.5,.2,0,()=>{remove(this.level.renderables,a)})}if(this.sticksToWall)for(let t=0;t<10;t++)this.level.particle({size:[6],color:"#888",duration:rnd(.4,.8),x:[this.x-15*this.sticksToWall,rnd(-20,20)],y:[this.y+rnd(-15,15),rnd(-20,20)]})}goToClosestAdjustment(t,e){let i,a=999;for(let s=0;s<e.length;s++){let l=dist(t,e[s]);l<a&&(i=e[s],a=l)}return i&&(this.x=i.x,this.y=i.y),i}allSnapAdjustments(){let t=this.x-15,e=this.x+15,i=this.y-15,a=this.y+15,s=toCellUnit(t),l=toCellUnit(e),r=toCellUnit(i),n=toCellUnit(a),h=(hasBlock(t,i),hasBlock(e,i),hasBlock(t,a),hasBlock(e,a),[this.previous.x,this.x]),o=[this.previous.y,this.y];for(let t=s;t<=l;t++)h.push(40*t+15,40*(t+1)-15-1e-4);for(let t=r;t<=n;t++)o.push(40*t+15,40*(t+1)-15-1e-4);return h.flatMap(t=>o.map(e=>({x:t,y:e}))).filter(t=>!hasBlock(t.x,t.y,15))}dust(t){for(let e=0;e<10;e++)this.level.particle({size:[4],color:"#888",duration:rnd(.4,.8),x:[this.x+rnd(-15,15),rnd(-10,10)],y:[t,sign(this.y-t)*rnd(10,5)]})}spawn(){for(let t=0;t<100;t++)this.level.particle({size:[10,-10],color:"#000",duration:rnd(1,2),x:[this.x+1.5*rnd(-15,15),rnd(-20,20)],y:[this.y+1.5*rnd(-15,15),rnd(-20,20)]})}readjust(){let{x:t,y:e}=this,i=this.allSnapAdjustments();this.goToClosestAdjustment(this,i);this.landed?(this.vY=min(0,this.vY),this.previous.landed||(this.dust(this.y+15),this.jumpStartTime=-1)):this.y>e&&(this.dust(this.y-15),this.vY=max(0,this.vY),this.jumpStartTime=-1),this.x!=t&&sign(this.x-t)!=this.facing&&(this.vX=0)}renderCharacter(t){renderPlayer(t,PLAYER_BODY,this.landed,this.facing*this.facingScale,this.walking,limit(0,(this.clock-this.jumpStartTime)/this.jumpPeakTime,1))}render(){wrap(()=>{translate(this.x,this.y),this.renderCharacter(R)})}}class Exit{constructor(t,e,i){this.level=t,this.x=e,this.y=i}cycle(t){this.level.player&&dist(this,this.level.player)<20&&this.level.foundExit()}render(){wrap(()=>{translate(this.x,this.y),drawImage(HALO,-HALO.width/2,-HALO.height/2),[G.clock*PI,-G.clock*PI/2,G.clock*PI/4].forEach(t=>{wrap(()=>{rotate(t),drawImage(GOD_RAY,-GOD_RAY.width/2,-GOD_RAY.height/2)})})});let t=COMPUTER.height+UNPADDED_DESK.height,e=toCellUnit(this.y);translate(this.x,40*(e+1)-t),drawImage(COMPUTER,-COMPUTER.width/2,0),drawImage(UNPADDED_DESK,-UNPADDED_DESK.width/2,COMPUTER.height)}}class PlayerSpotter{constructor(t){this.level=t,this.angle=0,this.halfFov=0,this.maxDistance=100}cycle(){this.foundPlayer||(this.foundPlayer=this.seesPlayer,this.foundPlayer&&this.level.wasFound())}get seesPlayer(){let t=angleBetween(this,this.level.player),e=dist(this,this.level.player);if(e<30)return 1;if(abs(normalize(this.angle-t))>this.halfFov||e>this.maxDistance)return 0;let i=castRay(this.x,this.y,t,this.maxDistance);return dist(this,i)>=e}render(){renderVision(this.x,this.y,this.angle-this.halfFov,this.angle+this.halfFov,this.maxDistance,this.foundPlayer?"#f00":"#ff0")}}class Camera extends PlayerSpotter{constructor(t,e){super(t),this.cycleDefinition=e,this.maxDistance=400,this.halfFov=.4}cycle(t){this.foundPlayer||this.cycleDefinition.update(this,this.level.clock),super.cycle(t)}render(){super.render(),wrap(()=>{translate(this.x,this.y),rotate(this.angle),fs("#888"),fr(-10,-5,20,10),fs("#444"),fr(10,-2,4,4),fs(this.level.clock%2>1?"#f00":"#0f0"),fr(6,-3,2,2)})}}class Guard extends PlayerSpotter{constructor(t,e){super(t),this.cycleDefinition=e,this.maxDistance=200,this.halfFov=.7,this.facing=1,this.facingScale=1}cycle(t){let{facing:e}=this;this.foundPlayer?this.facing=sign(this.level.player.x-this.x):this.cycleDefinition.update(this,this.level.clock),this.angle=this.facing>0?0:PI,super.cycle(t),e!=this.facing&&interp(this,"facingScale",-1,1,.1)}render(){super.render(),wrap(()=>{translate(this.x,this.y),renderPlayer(R,GUARD_BODY,1,this.facing*this.facingScale,this.walking,0)})}}class Cycle{constructor(){this.items=[],this.totalDuration=0}add(t,e){return this.items.push([t,this.totalDuration,e]),this.totalDuration+=t,this}update(t,e){let i=e%this.totalDuration,a=this.items.length-1;for(;this.items[a][1]>i;)a--;let[s,l,r]=this.items[a],n=(i-l)/s;this.constants(t),r(t,n)}}class CameraCycle extends Cycle{constructor(t,e,i){super(),this.lastAngle=i,this.x=toMiddleCellCoord(e),this.y=toMiddleCellCoord(t)}wait(t){let{lastAngle:e}=this;return this.add(t,t=>{t.angle=e})}rotateTo(t,e){let{lastAngle:i}=this;return this.lastAngle=e,this.add(t,(t,a)=>{t.angle=a*(e-i)+i})}constants(t){t.x=this.x,t.y=this.y}}class GuardCycle extends Cycle{constructor(t,e){super(),this.lastFacing=1,this.lastX=toMiddleCellCoord(e),this.y=toMiddleCellCoord(t)+5}wait(t){let{lastFacing:e,lastX:i}=this;return this.add(t,t=>{t.walking=0,t.x=i})}walkTo(t){let{lastX:e}=this,i=toMiddleCellCoord(t),a=abs(this.lastX-i)/100,s=sign(i-e);return this.lastX=i,this.lastFacing=s,this.add(a,(t,a)=>{t.facing=s,t.walking=1,t.x=a*(i-e)+e})}constants(t){t.y=this.y}}class Level{constructor(t,e){this.index=t,this.definition=e,this.stop()}endWith(t){this.ended||(this.ended=1,this.player.controllable=0,t())}foundExit(){this.endWith(()=>{let t=LEVELS[this.index+1];G.menu=new Menu("Infiltrating Core Systems...",t?"Breach Successful":"TOOK DOWN THE SYSTEM!"),G.menu.animateIn(),setTimeout(()=>{G.menu.animateOut()},2e3),setTimeout(()=>{t?G.nextLevel():G.endAnimation()},2500)})}wasFound(){this.endWith(()=>{G.menu=new Menu("Breach Unsuccessful!","PRESS [SPACE] TO TRY AGAIN"),G.menu.animateIn()}),setTimeout(()=>this.waitingForRetry=1,1e3)}start(){this.ended=0,this.clock=0,this.cyclables=[],this.renderables=[],this.player=new Player(this,toMiddleCellCoord(this.definition.spawn[1]),toMiddleCellCoord(this.definition.spawn[0])),this.exit=new Exit(this,toMiddleCellCoord(this.definition.exit[1]),toMiddleCellCoord(this.definition.exit[0])),this.cyclables.push(this.exit),this.renderables.push(this.exit),this.definition.cameras.forEach(t=>{let e=new Camera(this,t);this.cyclables.push(e),this.renderables.push(e)}),this.definition.guards.forEach(t=>{let e=new Guard(this,t);this.cyclables.push(e),this.renderables.push(e)}),setTimeout(()=>{this.player.controllable=1,this.player.spawn(),this.cyclables.push(this.player),this.renderables.push(this.player)},1e3)}stop(){this.cyclables=[],this.renderables=[]}cycle(t){this.clock+=t,this.cyclables.forEach(e=>e.cycle(t)),down[32]&&this.waitingForRetry&&(this.waitingForRetry=0,G.menu.animateOut(),setTimeout(()=>this.start(),1e3))}render(){R.fillStyle="#29c2fd",fr(0,0,800,800),R.fillStyle=LEVEL_BACKGROUND,fr(0,0,800,800),this.background=this.background||createLevelBackground(this),drawImage(this.background,0,0),this.renderables.forEach(t=>wrap(()=>t.render())),R.fillStyle="#010640";for(let t=0;t<20;t++)for(let e=0;e<20;e++)this.definition.matrix[t][e]&&fr(40*e,40*t,40,40);R.textAlign="center",R.textBaseline="middle",R.fillStyle="rgba(255,255,255,0.5)",R.font="30pt Impact",fillText(this.definition.message||"",LEVEL_WIDTH/2,100)}particle(t){let e;t.onFinish=(()=>remove(this.renderables,e)),this.renderables.push(e=new Particle(t))}}function SfxrParams(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var i=this.b+this.c+this.e;if(i<.18){var a=.18/i;this.b*=a,this.c*=a,this.e*=a}}}function SfxrSynth(){var t,e,i,a,s,l,r,n,h,o,c,d;this._params=new SfxrParams,this.resetManglable=function(){var t=this._params;a=100/(t.f*t.f+.001),s=100/(t.g*t.g+.001),l=1-t.h*t.h*t.h*.01,r=-t.i*t.i*t.i*1e-6,t.a||(c=.5-t.n/2,d=5e-5*-t.o),n=1+t.l*t.l*(t.l>0?-.9:10),h=0,o=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.resetManglable();var a=this._params;return t=a.b*a.b*1e5,e=a.c*a.c*1e5,i=a.e*a.e*1e5+12,3*((t+e+i)/3|0)},this.synthWave=function(u,f){var m=this._params,w=1!=m.s||m.v,p=m.v*m.v*.1,y=1+3e-4*m.w,g=m.s*m.s*m.s*.1,T=1+1e-4*m.t,x=1!=m.s,E=m.x*m.x,S=m.g,P=m.q||m.r,C=m.r*m.r*m.r*.2,v=m.q*m.q*(m.q<0?-1020:1020),A=m.p?32+((1-m.p)*(1-m.p)*2e4|0):0,R=m.d,I=m.j/2,k=m.k*m.k*.01,L=m.a,b=t,O=1/t,G=1/e,D=1/i,_=5/(1+m.u*m.u*20)*(.01+g);_>.8&&(_=.8),_=1-_;for(var H,B,j,W,N,M,V=0,U=0,Y=0,z=0,F=0,X=0,K=0,Q=0,q=0,J=0,Z=0,$=new Array(1024),tt=new Array(32),et=$.length;et--;)$[et]=0;for(et=tt.length;et--;)tt[et]=rnd(-1,1);for(et=0;et<f;et++){if(V)return et;if(A&&++J>=A&&(J=0,this.resetManglable()),o&&++h>=o&&(o=0,a*=n),(a*=l+=r)>s&&(a=s,S>0&&(V=1)),B=a,I>0&&(B*=1+sin(Z+=k)*I),(B|=0)<8&&(B=8),L||((c+=d)<0?c=0:c>.5&&(c=.5)),++Y>b)switch(Y=0,++U){case 1:b=e;break;case 2:b=i}switch(U){case 0:z=Y*O;break;case 1:z=1+2*(1-Y*G)*R;break;case 2:z=1-Y*D;break;case 3:z=0,V=1}P&&((j=0|(v+=C))<0?j=-j:j>1023&&(j=1023)),w&&y&&((p*=y)<1e-5?p=1e-5:p>.1&&(p=.1)),M=0;for(var it=8;it--;){if(++Q>=B&&(Q%=B,3==L))for(var at=tt.length;at--;)tt[at]=rnd(-1,1);switch(L){case 0:N=Q/B<c?.5:-.5;break;case 1:N=1-Q/B*2;break;case 2:N=.225*(((N=1.27323954*(W=6.28318531*((W=Q/B)>.5?W-1:W))+.405284735*W*W*(W<0?1:-1))<0?-1:1)*N*N-N)+N;break;case 3:N=tt[abs(32*Q/B|0)]}w&&(H=K,(g*=T)<0?g=0:g>.1&&(g=.1),x?(X+=(N-K)*g,X*=_):(K=N,X=0),F+=(K+=X)-H,N=F*=1-p),P&&($[q%1024]=N,N+=$[(q-j+1024)%1024],q++),M+=N}M*=.125*z*E,u[et]=M>=1?32767:M<=-1?-32768:32767*M|0}return f}}LEVELS=[{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"PRESS [SPACE] TO JUMP",cameras:[],guards:[]},{matrix:revertOptimizeMatrix(20,20,[[6,1,0,15],[7,7,7,0],[7,15,5,0],[11,11,8,0],[14,16,0,3],[17,7,0,4],[18,7,0,4]]),spawn:[16,2],exit:[5,4],message:"WALL JUMPS GET YOU HIGHER",cameras:[],guards:[]},{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[new CameraCycle(2,2,PI/4).wait(1).rotateTo(1,PI/2).wait(1).rotateTo(1,PI/4)],guards:[new GuardCycle(11,12).wait(1).walkTo(14).wait(1).walkTo(12)]},{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[new CameraCycle(2,2,PI/4).wait(1).rotateTo(1,PI/2).wait(1).rotateTo(1,PI/4)],guards:[new GuardCycle(4,2).wait(1).walkTo(4).wait(1).walkTo(2)]},{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[new CameraCycle(2,2,PI/4).wait(1).rotateTo(1,PI/2).wait(1).rotateTo(1,PI/4)],guards:[new GuardCycle(4,2).wait(1).walkTo(4).wait(1).walkTo(2)]},{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[new CameraCycle(2,2,PI/4).wait(1).rotateTo(1,PI/2).wait(1).rotateTo(1,PI/4)],guards:[new GuardCycle(4,2).wait(1).walkTo(4).wait(1).walkTo(2)]},{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[new CameraCycle(2,2,PI/4).wait(1).rotateTo(1,PI/2).wait(1).rotateTo(1,PI/4)],guards:[new GuardCycle(4,2).wait(1).walkTo(4).wait(1).walkTo(2)]},{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[new CameraCycle(2,2,PI/4).wait(1).rotateTo(1,PI/2).wait(1).rotateTo(1,PI/4)],guards:[new GuardCycle(4,2).wait(1).walkTo(4).wait(1).walkTo(2)]},{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[new CameraCycle(2,2,PI/4).wait(1).rotateTo(1,PI/2).wait(1).rotateTo(1,PI/4)],guards:[new GuardCycle(4,2).wait(1).walkTo(4).wait(1).walkTo(2)]},{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[new CameraCycle(2,2,PI/4).wait(1).rotateTo(1,PI/2).wait(1).rotateTo(1,PI/4)],guards:[new GuardCycle(4,2).wait(1).walkTo(4).wait(1).walkTo(2)]},{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[new CameraCycle(2,2,PI/4).wait(1).rotateTo(1,PI/2).wait(1).rotateTo(1,PI/4)],guards:[new GuardCycle(4,2).wait(1).walkTo(4).wait(1).walkTo(2)]},{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[new CameraCycle(2,2,PI/4).wait(1).rotateTo(1,PI/2).wait(1).rotateTo(1,PI/4)],guards:[new GuardCycle(4,2).wait(1).walkTo(4).wait(1).walkTo(2)]},{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[new CameraCycle(2,2,PI/4).wait(1).rotateTo(1,PI/2).wait(1).rotateTo(1,PI/4)],guards:[new GuardCycle(4,2).wait(1).walkTo(4).wait(1).walkTo(2)]},{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[new CameraCycle(2,2,PI/4).wait(1).rotateTo(1,PI/2).wait(1).rotateTo(1,PI/4)],guards:[new GuardCycle(4,2).wait(1).walkTo(4).wait(1).walkTo(2)]},{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[16,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[new CameraCycle(2,2,PI/4).wait(1).rotateTo(1,PI/2).wait(1).rotateTo(1,PI/4)],guards:[new GuardCycle(4,2).wait(1).walkTo(4).wait(1).walkTo(2)]}].map((t,e)=>new Level(e,t));var synth=new SfxrSynth,jsfxr=function(t){synth._params.setSettings(t);var e=synth.totalReset(),i=new Uint8Array(4*((e+1)/2|0)+44),a=2*synth.synthWave(new Uint16Array(i.buffer,44),e),s=new Uint32Array(i.buffer,0,44);s[0]=1179011410,s[1]=a+36,s[2]=1163280727,s[3]=544501094,s[4]=16,s[5]=65537,s[6]=44100,s[7]=88200,s[8]=1048578,s[9]=1635017060,s[10]=a,a+=44;for(var l=0,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="data:audio/wav;base64,";l<a;l+=3){var h=i[l]<<16|i[l+1]<<8|i[l+2];n+=r[h>>18]+r[h>>12&63]+r[h>>6&63]+r[63&h]}var o=new Audio;return o.src=n,o};jumpSound=jsfxr([0,,.1434,,.1212,.4471,,.2511,,,,,,.0426,,,,,.8862,,,,,.5]),hitSound=jsfxr([1,,.0713,,.1467,.5483,,-.4465,,,,,,,,,,,1,,,.0639,,.5]),pickupSound=jsfxr([0,,.0224,.441,.1886,.6932,,,,,,,,,,,,,1,,,,,.5]),spawnSound=jsfxr([2,.28,.45,,.56,.35,,.4088,,,,,.03,.1557,,.5565,-.02,-.02,1,,,,,.5]),explosionSound=jsfxr([3,,.244,.6411,.2242,.7416,,-.2717,,,,.0171,.0346,,,,-.0305,.0244,1,,,.0275,-.0076,.5]),menuSound=jsfxr([0,,.1394,,.0864,.48,,,,,,,,.5326,,,,,1,,,.1,,.5]),saySound=jsfxr([2,.03,.1,.14,.25,.54,.3167,-.02,.3999,,.05,,,.1021,.0684,,.1287,-.1816,1,,,,,.46]),landSound=jsfxr([3,,.0118,.03,.1681,.565,,-.2343,,,,.26,.6855,,,,,,1,,,,,.2]),fixedSound=jsfxr([0,,.2098,,.4725,.3665,,.1895,,,,,,.0067,,.5437,,,1,,,,,.45]),w.down={},onkeydown=(t=>{w.down[t.keyCode]=1}),onkeyup=(t=>{w.down[t.keyCode]=0});let LEVEL_WIDTH=800,LEVEL_HEIGHT=800,TOWER_BASE_HEIGHT=(800-LEVEL_HEIGHT)/2,LEVEL_X=400,MAX_LEVEL_ALTITUDE=LEVELS.length*LEVEL_HEIGHT+TOWER_BASE_HEIGHT;class Game{constructor(){(G=this).clock=0,this.level=LEVELS[0],this.bottomScreenAltitude=MAX_LEVEL_ALTITUDE+LEVEL_HEIGHT-400+100,this.windowsAlpha=1,this.titleAlpha=1,this.title="HACKER",this.interTitle="VS"}startAnimation(){this.isStarted||(this.isStarted=1,interp(this,"titleAlpha",1,0,.5),interp(this,"bottomScreenAltitude",this.bottomScreenAltitude,-TOWER_BASE_HEIGHT,5,.5,easeInOutCubic,()=>{interp(this,"windowsAlpha",1,0,1,1,0),this.startLevel(this.level)}))}endAnimation(){this.isStarted=0,interp(this,"bottomScreenAltitude",this.bottomScreenAltitude,MAX_LEVEL_ALTITUDE+LEVEL_HEIGHT-400+100,2,.5,easeInOutCubic),interp(this,"windowsAlpha",0,1,1,1),this.title="YOU BEAT",this.interTitle="",interp(this,"titleAlpha",0,1,1,3)}cycle(t){this.clock+=t,down[32]&&this.startAnimation(),this.level.cycle(t),INTERPOLATIONS.slice().forEach(e=>e.cycle(t)),this.menu&&this.menu.cycle(t),this.render()}nextLevel(){this.level.stop(),this.startLevel(LEVELS[this.level.index+1])}startLevel(t){this.level=t,this.centerLevel(this.level),this.level.start()}centerLevel(t){interp(this,"bottomScreenAltitude",this.bottomScreenAltitude,this.levelBottomAltitude(t)-TOWER_BASE_HEIGHT,.5)}levelBottomAltitude(t){return t.index*LEVEL_HEIGHT}render(){R.fillStyle=SKY_BACKGROUND,fr(0,0,1600,800),R.fillStyle="#fff",beginPath(),arc(1400,100,50,0,2*PI,1),fill(),BUILDINGS_BACKGROUND.forEach((t,e)=>wrap(()=>{let i=.2+.8*e/(BUILDINGS_BACKGROUND.length-1),a=this.bottomScreenAltitude/MAX_LEVEL_ALTITUDE;R.fillStyle=t,translate(0,~~(800-t.height+a*i*400)),fr(0,0,1600,t.height)})),wrap(()=>{translate(LEVEL_X,this.bottomScreenAltitude+LEVEL_HEIGHT+TOWER_BASE_HEIGHT);let t=LEVELS.indexOf(this.level);for(let e=max(0,t-1);e<min(LEVELS.length,t+2);e++)wrap(()=>{translate(0,-this.levelBottomAltitude(LEVELS[e])-LEVEL_HEIGHT),LEVELS[e].render()});wrap(()=>{translate(0,-MAX_LEVEL_ALTITUDE-LEVEL_HEIGHT),wrap(()=>{translate(LEVEL_WIDTH/2-240,0),fs(SIGN_HOLDER_PATTERN),fr(0,0,480,-80)}),R.textAlign="center",R.textBaseline="alphabetic",R.fillStyle="#900",R.strokeStyle="#f00",R.lineWidth=5,R.font="italic 96pt Impact",fillText("CYBERSPACE",LEVEL_WIDTH/2,-30),strokeText("CYBERSPACE",LEVEL_WIDTH/2,-30),R.globalAlpha=.5,[30,90,150,210].forEach(t=>wrap(()=>{scale(1,-1),drawImage(GOD_RAY,LEVEL_WIDTH/2+t-GOD_RAY.width/2,-GOD_RAY.height/2),drawImage(GOD_RAY,LEVEL_WIDTH/2-t-GOD_RAY.width/2,-GOD_RAY.height/2)}))}),R.globalAlpha=this.windowsAlpha,R.fillStyle=BUILDING_PATTERN,wrap(()=>{fr(0,0,LEVEL_WIDTH,-MAX_LEVEL_ALTITUDE-LEVEL_HEIGHT)})}),this.menu&&wrap(()=>this.menu.render()),wrap(()=>{R.globalAlpha=this.titleAlpha,R.textAlign="center",R.textBaseline="alphabetic",R.fillStyle="#fff",R.strokeStyle="#000",R.lineWidth=5,R.font="italic 120pt Impact",fillText(this.title,800,800/3+45),strokeText(this.title,800,800/3+45),R.font="24pt Impact",R.lineWidth=2,fillText(this.interTitle,800,800/3+85),strokeText(this.interTitle,800,800/3+85),G.clock%2<1.5&&1==this.titleAlpha&&(fillText("PRESS [SPACE] TO START",800,640),strokeText("PRESS [SPACE] TO START",800,640))})}}onload=(()=>{onresize(),CANVAS.width=1600,CANVAS.height=800,R=CANVAS.getContext("2d"),Object.getOwnPropertyNames(canvasProto).forEach(t=>{R[t].call&&(w[t]=canvasProto[t].bind(R))}),new Game;let t=Date.now(),e=()=>{let i=Date.now(),a=min((i-t)/1e3,100);t=i,G.cycle(a),requestAnimationFrame(e)};e()});</script>