<meta name="monetization" content="$twitter.xrptipbot.com/remvst"><title>[SWAGSHOT]</title><style>/* *{margin:0;width:100%;height:100%;background:#000;position:relative}#t{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}#g{display:block} */</style><div id="t"><canvas id="g"></canvas></div><script src="//game-cdn.poki.com/scripts/v2/poki-sdk.js"></script><script>function revertOptimizeMatrix(t,e,i){const a=[],s=Array(e).fill(1);a.push(s);for(let i=0;i<t-2;i++){const t=[];t.length=e,t[0]=1,t[e-1]=1,a.push(t)}return a.push(s),i.forEach(t=>{let[e,i,s,l]=t,r=!!s,h=!!l;for(let t=0;t<max(s,l);t++)a[e+t*r][i+t*h]=1}),a}let R,G,W,P,w=window,onMenu=1,CANVAS=g;limit=((t,e,i)=>e<t?t:e>i?i:e),between=((t,e,i)=>e>=t&&e<=i),rnd=((t,e)=>random()*(e-t)+t),pick=(t=>t[~~(random()*t.length)]),distP=((t,e,i,a)=>sqrt(pow(t-i,2)+pow(e-a,2))),dist=((t,e)=>distP(t.x,t.y,e.x,e.y)),normalize=(t=>moduloWithNegative(t,PI)),angleBetween=((t,e)=>atan2(e.y-t.y,e.x-t.x)),roundToNearest=((t,e)=>round(t/e)*e),moduloWithNegative=((t,e)=>((t%=2*e)>e&&(t-=2*e),t<-e&&(t+=2*e),t));let math=Math;Object.getOwnPropertyNames(math).forEach(t=>w[t]=w[t]||math[t]),TWO_PI=2*PI;let canvasProto=CanvasRenderingContext2D.prototype;canvasProto.wrap=function(t){this.save(),t(),this.restore()},canvasProto.fr=canvasProto.fillRect,canvasProto.fs=function(t){this.fillStyle=t},canvasProto.roundedRectangle=function(t,e,i,a,s){PI;let l=2*PI/2,r=2*PI/4;this.arc(s+t,s+e,s,-r,l,1),this.arc(s+t,a-s+e,s,l,r,1),this.arc(t+i-s,e+a-s,s,r,0,1),this.arc(t+i-s,e+s,s,0,-r,1)},onresize=(()=>{var e,i,a=innerWidth,s=innerHeight,l=a/s,r=t.style;l<=2?i=(e=a)/2:e=2*(i=s),r.width=e+"px",r.height=i+"px"}),linear=(t=>t),easeOutQuad=(t=>t*(2-t)),easeOutQuint=(t=>1+--t*t*t*t*t),easeInQuint=(t=>t*t*t*t*t),interp=((t,e,i,a,s,l,r,h)=>{let n={o:t,p:e,a:i,b:a,d:s,l:l||0,f:r||linear,e:h||(()=>0),t:0,cycle:t=>{if(n.l>0)n.l-=t,n.o[n.p]=n.a;else if(n.t=min(n.d,n.t+t),n.o[n.p]=n.f(n.t/n.d)*(n.b-n.a)+n.a,n.t==n.d){n.e();let t=INTERPOLATIONS.indexOf(n);t>=0&&INTERPOLATIONS.splice(t,1)}}};INTERPOLATIONS.push(n)}),INTERPOLATIONS=[],castRay=((t,e,i,a)=>{let s,l=castAgainstHorizontal(t,e,i,a),r=castAgainstVertical(t,e,i,a);if(l)if(r){s=distP(t,e,l.x,l.y)<distP(t,e,r.x,r.y)?l:r}else s=l;else s=r;return distP(t,e,s.x,s.y)>a&&(s={x:t+cos(i)*a,y:e+sin(i)*a}),s}),castAgainstHorizontal=((t,e,i,a)=>{var s=sin(i)>0,l=40*~~(e/40)+(s?40:-1e-4),r=t+(l-e)/tan(i),h=s?40:-40,n=h/tan(i);return doCast(r,l,n,h,1,a)}),castAgainstVertical=((t,e,i,a)=>{var s=cos(i)>0,l=40*~~(t/40)+(s?40:-1e-4),r=e+(l-t)*tan(i),h=s?40:-40,n=h*tan(i);return doCast(l,r,h,n,0,a)}),doCast=((t,e,i,a,s,l)=>{let r=t,h=e;for(let n=0;distP(r,h,t,e)<l;n++){if(internalHasBlock(r,h)){let t=~~(r/40)+~~(h/40)*G.level.definition.matrix.length;return{x:r,y:h,castType:s+"-"+t,blockId:t}}if(isOut(r,h))break;r+=i,h+=a}return{x:r,y:h,castType:""}}),hasBlock=((t,e,i=0)=>internalHasBlock(t,e)||internalHasBlock(t-i,e-i)||internalHasBlock(t-i,e+i)||internalHasBlock(t+i,e-i)||internalHasBlock(t+i,e+i)),internalHasBlock=((t,e)=>!isOut(t,e)&&G.level.definition.matrix[~~(e/40)][~~(t/40)]),isOut=((t,e)=>!between(0,t,40*G.level.definition.matrix[0].length-1)||!between(0,e,40*G.level.definition.matrix.length-1)),toCellUnit=(t=>~~(t/40)),remove=((t,e)=>{let i=t.indexOf(e);i>=0&&t.splice(i,1)});class PointRenderable{constructor(t,e,i,a){this.x=t,this.y=e,this.radius=i,this.color=a}render(){R.fillStyle=this.color,fr(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}createNumberGenerator=(t=>{let e=new Uint32Array([imul(t,2246822507),imul(t,3266489909)]),i=()=>{let t=e[0],i=e[1]^t;return e[0]=(t<<26|t>>8)^i^i<<9,e[1]=i<<13|i>>19,(imul(t,2654435771)>>>0)/4294967295};return{pick:t=>t[~~(i()*t.length)],between:(t,e)=>i()*(e-t)+t,floating:i}});let createCanvas=(t,e,i)=>{let a=document.createElement("canvas");return a.width=t,a.height=e,i(a.getContext("2d"),a)||a},createCanvasPattern=(t,e,i)=>{let a=createCanvas(t,e,i);return a.getContext("2d").createPattern(a,"repeat")};padCanvas=((t,e,i,a)=>createCanvas(40*e,40*t,(t,e)=>{let s;s=e.height*i-a.height*i,t.drawImage(a,(e.width-a.width)/2,s)})),SKY_BACKGROUND=createCanvasPattern(200,800,t=>{let e=t.createLinearGradient(0,0,0,800);e.addColorStop(0,"#00032c"),e.addColorStop(.7,"#14106f"),e.addColorStop(1,"#64196c"),t.fillStyle=e,t.fr(0,0,200,800)}),GOD_RAY=createCanvas(24,160,(t,e)=>{let i=t.createLinearGradient(0,0,0,160);i.addColorStop(0,"rgba(255,255,255, 0)"),i.addColorStop(.5,"rgba(255,255,255, 0.5)"),i.addColorStop(1,"rgba(255,255,255, 0)"),t.fillStyle=i,t.fillRect(0,0,99,999)}),HALO=createCanvas(160,160,(t,e)=>{let i=t.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,e.width/2);i.addColorStop(.5,"rgba(255,255,255, 0.5)"),i.addColorStop(1,"rgba(255,255,255, 0)"),t.fillStyle=i,t.fillRect(0,0,999,999)}),COMPUTER=createCanvas(24,24,(t,e)=>{t.fillStyle="#000",t.fr(0,0,99,99),t.fillStyle="#a9a9a9",t.fr(2,2,e.width-4,e.height-4),t.fillStyle="#4253ff",t.fr(4,4,e.width-8,e.height-12),t.fillStyle="#000",t.fr(4,e.height-6,e.width-8,2),t.fillStyle="#a5dc40",t.fr(e.width-6,e.height-6,2,2)}),WINDOW_PATTERN=createCanvasPattern(80,80,(t,e)=>{t.fillStyle="#8c9bee",t.fillRect(0,0,999,999),t.fillStyle="#f29afb",t.fillRect(e.width/4,e.height/4,e.width/2,e.width/2)}),BUILDINGS_BACKGROUND=createCanvasPattern(800,400,(t,e)=>{t.fillStyle=WINDOW_PATTERN,t.fillRect(0,0,e.width,e.height)}),FRAME=padCanvas(1,1,.5,createCanvas(24,32,(t,e)=>{t.fillStyle="#925e2a",t.fillRect(0,0,99,99),t.fillStyle="#fcf3d7",t.fillRect(4,4,e.width-8,e.height-8),t.fillStyle="#ccc",t.fillRect(e.width/2-5,e.height/2-5,10,10)})),WINDOW=padCanvas(2,1,.5,createCanvas(32,48,(t,e)=>{t.fillStyle="#494742",t.fillRect(0,0,99,99),t.fillStyle="#b8c8fa",t.fillRect(2,2,e.width-4,e.height-4),t.fillStyle="#494742",t.fillRect(0,.7*e.height,e.width,4)})),UNPADDED_DESK=createCanvas(44,20,(t,e)=>{t.fillStyle="#000",t.fillRect(2,0,2,e.height),t.fillRect(e.width-2,0,-2,e.height),t.fillStyle="#494742",t.fillRect(0,0,99,4),t.fillStyle="#ccc",t.fillRect(4,4,e.width/4,e.height/3),t.fillRect(e.width-4,4,-e.width/4,e.height/3)}),DESK=padCanvas(1,2,1,UNPADDED_DESK),TRASH=padCanvas(1,1,1,createCanvas(12,16,(t,e)=>{t.fillStyle="#4c80be",t.fillRect(0,0,99,99),t.fillStyle="#78a1d6",t.fillRect(0,0,99,4)})),OUTLET=padCanvas(1,1,.75,createCanvas(8,8,(t,e)=>{t.fillStyle="#fff",t.fillRect(0,0,99,99)})),LIGHT=padCanvas(3,10,0,createCanvas(200,120,(t,e)=>{let i=t.createRadialGradient(e.width/2,0,0,e.width/2,0,e.height);i.addColorStop(0,"rgba(255,255,255,0.5)"),i.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=i,t.beginPath(),t.moveTo(e.width/2,0),t.arc(e.width/2,0,e.height,PI/6,5*PI/6,0),t.fill()})),LEVEL_BACKGROUND=createCanvasPattern(160,240,(t,e)=>{t.fillStyle="#29c2fd",t.fr(0,0,e.width,e.height),t.fillStyle="#000",t.globalAlpha=.05,t.fr(0,0,e.width,2),t.fr(0,120,e.width,2),t.fr(0,0,2,120),t.fr(80,120,2,400)}),createLevelBackground=(t=>createCanvas(800,800,(e,i)=>{e.fillStyle=LEVEL_BACKGROUND,e.fr(0,0,i.width,i.height);let a=createNumberGenerator(1),s=t.definition.matrix,l=s.map(t=>t.slice());l[t.definition.exit[0]][t.definition.exit[1]]=1;let r=[];for(let t=1;t<19;t++)for(let i=1;i<19;i++){if(l[t][i])continue;let a=a=>()=>{for(let e=0;e<a.height/40;e++)for(let s=0;s<a.width/40;s++)if(l[t+e][i+s])return;for(let e=0;e<a.height/40;e++)for(let s=0;s<a.width/40;s++)l[t+e][i+s]=1;e.drawImage(a,40*i,40*t)},h=l[t][i],n=l[t][i+1],o=l[t+1][i],c=(l[t-1][i],l[t+2]&&l[t+2][i]),d=l[t+1][i+1],f=[];!h&&o&&(f.push(a(TRASH)),f.push(a(OUTLET))),!s[t-1][i]||s[t][i]||s[t+1][i]||i%2||e.drawImage(LIGHT,40*(i+.5)-LIGHT.width/2,40*t),!o&&c&&(f.push(a(FRAME)),f.push(a(WINDOW))),o&&!n&&d&&f.push(a(DESK)),f.length&&r.push(f)}r.flat().forEach(t=>{a.floating()<.15&&t()})}));class Particle{constructor(t){let e=t.duration||1;this.color=t.color||"#f00";let i=t.size||[5,5],a=t.alpha||[1,-1];interp(this,"x",t.x[0],t.x[0]+t.x[1],e),interp(this,"y",t.y[0],t.y[0]+t.y[1],e),interp(this,"alpha",a[0],a[0]+a[1],e),interp(this,"size",i[0],i[0]+(i[1]||0),e,0,0,t.onFinish)}render(){R.globalAlpha=this.alpha,fs(this.color),beginPath(),arc(this.x,this.y,this.size/2,0,TWO_PI),fill()}}class Menu{constructor(t,e){this.title=t,this.subtitle=e,this.titlePosition=this.subtitlePosition=9999,this.dimAlpha=0}animateIn(){interp(this,"titlePosition",-400,400,.5,0,easeOutQuint),interp(this,"subtitlePosition",1200,400,.5,1,easeOutQuint),interp(this,"dimAlpha",0,1,.3)}animateOut(){interp(this,"titlePosition",400,1200,.5,0,easeInQuint),interp(this,"subtitlePosition",400,-400,.5,0,easeInQuint,()=>G.menu=0),interp(this,"dimAlpha",1,0,.3,.2)}render(){translate(400,0),beginPath(),rect(0,0,800,800),clip(),R.fillStyle="rgba(0,0,0,"+.8*this.dimAlpha+")",fr(0,0,800,800),R.textAlign="center",R.textBaseline="middle",R.fillStyle="#fff",R.font="italic 24pt Impact",fillText(this.title,this.titlePosition,375),R.font="italic 48pt Impact",fillText(this.subtitle,this.subtitlePosition,425)}}renderVision=((t,e,i,a,s,l)=>wrap(()=>{R.fillStyle=R.strokeStyle=l,R.lineWidth=2,R.globalAlpha=.3,beginPath(),moveTo(t,e);for(let l=0;l<=30;l++){let r=l/30*(a-i)+i;l&&l<30&&(r=roundToNearest(r,(a-i)/30));let h=castRay(t,e,r,s);lineTo(h.x,h.y)}closePath(),fill(),stroke()}));class Level{constructor(t,e){this.index=t,this.definition=e,this.windowsAlpha=0,this.stop()}foundExit(){remove(this.cyclables,this.exit),this.player.controllable=0,G.menu=new Menu("SEARCHING FOR EVIL PLANS...","404 NOT FOUND"),G.menu.animateIn(),setTimeout(()=>{G.menu.animateOut()},2e3),setTimeout(()=>{G.nextLevel(),interp(this,"windowsAlpha",0,1,.2)},2500)}start(){interp(this,"windowsAlpha",1,0,.2),this.clock=0,this.cyclables=[],this.renderables=[],this.player=new Player(this,40*(this.definition.spawn[1]+.5),40*(this.definition.spawn[0]+.5)),this.exit=new Exit(this,40*(this.definition.exit[1]+.5),40*(this.definition.exit[0]+.5)),this.cyclables.push(this.exit),this.renderables.push(this.exit),this.definition.cameras.forEach(([t,e,i,a,s,l])=>{let r=new Camera(this,40*(e+.5),40*(t+.5),i,a,s,l);this.cyclables.push(r),this.renderables.push(r)});let t=G.menu=new Menu("Floor "+(this.index+1),"");t.animateIn(),setTimeout(()=>{t.animateOut(),this.player.controllable=1,this.player.spawn(),this.cyclables.push(this.player),this.renderables.push(this.player)},2e3)}stop(){this.cyclables=[],this.renderables=[]}cycle(t){this.clock+=t,this.cyclables.forEach(e=>e.cycle(t))}render(){R.fillStyle="#29c2fd",R.fillStyle=LEVEL_BACKGROUND,fr(0,0,800,800),this.background=this.background||createLevelBackground(this),drawImage(this.background,0,0),R.fillStyle="rgba(0,0,0,0.2)";for(let t=0;t<20;t++)fr(0,40*t,800,1),fr(40*t,0,1,800);R.textAlign="center",R.textBaseline="middle",R.fillStyle="rgba(255,255,255,0.5)",R.font="italic 24pt Impact";fillText(this.definition.message||"",400,160),this.renderables.forEach(t=>wrap(()=>t.render())),R.fillStyle="#010640";for(let t=0;t<20;t++)for(let e=0;e<20;e++)this.definition.matrix[t][e]&&fr(40*e,40*t,40,40);R.globalAlpha=this.windowsAlpha,R.fillStyle=WINDOW_PATTERN}particle(t){let e;t.onFinish=(()=>remove(this.renderables,e)),this.renderables.push(e=new Particle(t))}}LEVELS=[{matrix:revertOptimizeMatrix(20,20,[[6,13,0,6],[9,7,0,3],[12,12,0,3],[15,7,4,0],[15,8,4,0],[15,9,4,0],[17,5,2,0],[17,6,2,0],[17,10,2,0],[17,11,2,0]]),spawn:[9,2],exit:[5,17],message:"Press [SPACE] to jump",cameras:[[2,2,PI/2,PI/4,1,2]]},{matrix:revertOptimizeMatrix(20,20,[[4,4,1,0],[4,9,0,4],[5,5,1,0],[6,4,1,0],[7,15,0,2],[8,7,0,2],[8,10,1,0],[10,1,0,2],[10,13,0,2],[13,10,0,2],[14,7,3,0],[16,5,0,2]]),spawn:[2,2],exit:[15,17]},{matrix:revertOptimizeMatrix(20,20,[[4,4,1,0],[4,9,0,4],[5,5,1,0],[6,4,1,0],[7,15,0,2],[8,7,0,2],[8,10,1,0],[10,1,0,2],[10,13,0,2],[13,10,0,2],[14,7,3,0],[16,5,0,2]]),spawn:[2,2],exit:[15,17]},{matrix:revertOptimizeMatrix(20,20,[[4,4,1,0],[4,9,0,4],[5,5,1,0],[6,4,1,0],[7,15,0,2],[8,7,0,2],[8,10,1,0],[10,1,0,2],[10,13,0,2],[13,10,0,2],[14,7,3,0],[16,5,0,2]]),spawn:[2,2],exit:[15,17]},{matrix:revertOptimizeMatrix(20,20,[[4,4,1,0],[4,9,0,4],[5,5,1,0],[6,4,1,0],[7,15,0,2],[8,7,0,2],[8,10,1,0],[10,1,0,2],[10,13,0,2],[13,10,0,2],[14,7,3,0],[16,5,0,2]]),spawn:[10,2],exit:[15,17]},{matrix:revertOptimizeMatrix(20,20,[[4,4,1,0],[4,9,0,4],[5,5,1,0],[6,4,1,0],[7,15,0,2],[8,7,0,2],[8,10,1,0],[10,1,0,2],[10,13,0,2],[13,10,0,2],[14,7,3,0],[16,5,0,2]]),spawn:[2,2]},{matrix:revertOptimizeMatrix(20,20,[[4,4,1,0],[4,9,0,4],[5,5,1,0],[6,4,1,0],[7,15,0,2],[8,7,0,2],[8,10,1,0],[10,1,0,2],[10,13,0,2],[13,10,0,2],[14,7,3,0],[16,5,0,2]]),spawn:[2,2]},{matrix:revertOptimizeMatrix(20,20,[[4,4,1,0],[4,9,0,4],[5,5,1,0],[6,4,1,0],[7,15,0,2],[8,7,0,2],[8,10,1,0],[10,1,0,2],[10,13,0,2],[13,10,0,2],[14,7,3,0],[16,5,0,2]]),spawn:[2,2]},{matrix:revertOptimizeMatrix(20,20,[[4,4,1,0],[4,9,0,4],[5,5,1,0],[6,4,1,0],[7,15,0,2],[8,7,0,2],[8,10,1,0],[10,1,0,2],[10,13,0,2],[13,10,0,2],[14,7,3,0],[16,5,0,2]]),spawn:[2,2]},{matrix:revertOptimizeMatrix(20,20,[[4,4,1,0],[4,9,0,4],[5,5,1,0],[6,4,1,0],[7,15,0,2],[8,7,0,2],[8,10,1,0],[10,1,0,2],[10,13,0,2],[13,10,0,2],[14,7,3,0],[16,5,0,2]]),spawn:[2,2]},{matrix:revertOptimizeMatrix(20,20,[[4,4,1,0],[4,9,0,4],[5,5,1,0],[6,4,1,0],[7,15,0,2],[8,7,0,2],[8,10,1,0],[10,1,0,2],[10,13,0,2],[13,10,0,2],[14,7,3,0],[16,5,0,2]]),spawn:[2,2]},{matrix:revertOptimizeMatrix(20,20,[[4,4,1,0],[4,9,0,4],[5,5,1,0],[6,4,1,0],[7,15,0,2],[8,7,0,2],[8,10,1,0],[10,1,0,2],[10,13,0,2],[13,10,0,2],[14,7,3,0],[16,5,0,2]]),spawn:[2,2]},{matrix:revertOptimizeMatrix(20,20,[[4,4,1,0],[4,9,0,4],[5,5,1,0],[6,4,1,0],[7,15,0,2],[8,7,0,2],[8,10,1,0],[10,1,0,2],[10,13,0,2],[13,10,0,2],[14,7,3,0],[16,4,3,0],[16,5,0,2]]),spawn:[2,2]}].map((t,e)=>new Level(e,t));class Player{constructor(t,e,i){this.level=t,this.x=e,this.y=i,this.previous={},this.vX=this.vY=0,this.facing=1,this.walking=0,this.facingScale=1,this.jumpHoldTime=0,this.jumpReleased=1,this.jumpStartY=0,this.jumpEndY=0,this.jumpPeakTime=0,this.controllable=0,this.wasStickingToWallX=0,this.clock=0,this.bandanaTrail=[]}get landed(){let t=this.x-15,e=this.x+15,i=this.y+15+1;return hasBlock(t,i)||hasBlock(e,i)}get sticksToWall(){if(this.landed)return 0;this.wasStickingToWallX,this.x;let t=this.x-15-1,e=this.x+15+1;return hasBlock(t,this.y)&&(w.down[37]||this.wasStickingToWallX)?(this.wasStickingToWallX=this.x,1):hasBlock(e,this.y)&&(w.down[39]||this.wasStickingToWallX)?(this.wasStickingToWallX=this.x,-1):0}cycle(t){let e=t;do{let t=min(e,1/60);e-=t,this.subCycle(t)}while(e>0)}subCycle(t){this.previous.x=this.x,this.previous.y=this.y,this.previous.clock=this.clock,this.previous.facing=this.facing,this.previous.landed=this.landed,this.previous.jumpHoldTime=this.jumpHoldTime,this.clock+=t;let e=down[32]&&this.controllable;if(this.jumpReleased=this.jumpReleased||!e,e?this.jumpHoldTime+=t:this.jumpHoldTime=0,e&&this.jumpReleased&&(this.landed||this.sticksToWall)&&(this.jumpReleased=0,this.jumpStartY=this.y,this.jumpStartTime=this.clock,this.vX+=800*this.sticksToWall),e&&!this.jumpReleased){let t=min(this.jumpHoldTime,.15)/.15,e=20+40*t*3;this.jumpPeakTime=.1+.2*t,this.jumpEndY=this.jumpStartY-e}if(this.clock<this.jumpStartTime+this.jumpPeakTime){let t=(this.clock-this.jumpStartTime)/this.jumpPeakTime;this.y=easeOutQuad(t)*(this.jumpEndY-this.jumpStartY)+this.jumpStartY}else{let e=this.sticksToWall&&this.vY>0?1e3:4e3;this.vY=max(0,this.vY+e*t),this.y+=this.vY*t}let i=0,a=0;this.controllable&&(down[37]&&(i=-1,a=-400),down[39]&&(i=1,a=400)),this.landed&&i&&(this.facing=i),this.facing!=this.previous.facing&&interp(this,"facingScale",-1,1,.1),this.walking=i;let s=this.landed?3e3:1500;for(this.vX+=limit(-s*t,a-this.vX,s*t),this.x+=this.vX*t,this.readjust(),this.bandanaTrail.unshift({x:this.x-5*this.facing,y:this.y-10+rnd(-1,1)});this.bandanaTrail.length>30;)this.bandanaTrail.pop();if(this.bandanaTrail.forEach(e=>e.y+=100*t),!this.landed&&!this.sticksToWall){let{x:t,y:e}=this,i=createCanvas(80,80,t=>{t.translate(40,40),this.renderCharacter(t)}),a={render:()=>{R.globalAlpha=a.alpha,drawImage(i,t-i.width/2,e-i.height/2)}};this.level.renderables.push(a),interp(a,"alpha",.1,0,.5,.2,0,()=>{remove(this.level.renderables,a)})}if(this.sticksToWall)for(let t=0;t<10;t++)this.level.particle({size:[6],color:"#888",duration:rnd(.4,.8),x:[this.x-15*this.sticksToWall,rnd(-20,20)],y:[this.y+rnd(-15,15),rnd(-20,20)]})}goToClosestAdjustment(t,e){let i,a=999;for(let s=0;s<e.length;s++){let l=dist(t,e[s]);l<a&&(i=e[s],a=l)}return i&&(this.x=i.x,this.y=i.y),i}allSnapAdjustments(){let t=this.x-15,e=this.x+15,i=this.y-15,a=this.y+15,s=toCellUnit(t),l=toCellUnit(e),r=toCellUnit(i),h=toCellUnit(a),n=(hasBlock(t,i),hasBlock(e,i),hasBlock(t,a),hasBlock(e,a),[this.previous.x,this.x]),o=[this.previous.y,this.y];for(let t=s;t<=l;t++)n.push(40*t+15,40*(t+1)-15-1e-4);for(let t=r;t<=h;t++)o.push(40*t+15,40*(t+1)-15-1e-4);return n.flatMap(t=>o.map(e=>({x:t,y:e}))).filter(t=>!hasBlock(t.x,t.y,15))}dust(t){for(let e=0;e<10;e++)this.level.particle({size:[4],color:"#888",duration:rnd(.4,.8),x:[this.x+rnd(-15,15),rnd(-10,10)],y:[t,sign(this.y-t)*rnd(10,5)]})}spawn(){for(let t=0;t<100;t++)this.level.particle({size:[10,-10],color:"#000",duration:rnd(1,2),x:[this.x+1.5*rnd(-15,15),rnd(-20,20)],y:[this.y+1.5*rnd(-15,15),rnd(-20,20)]})}readjust(){let{x:t,y:e}=this,i=this.allSnapAdjustments();this.goToClosestAdjustment(this,i);this.landed?(this.vY=min(0,this.vY),this.previous.landed||(this.dust(this.y+15),this.jumpStartTime=-1)):this.y>e&&(this.dust(this.y-15),this.vY=max(0,this.vY),this.jumpStartTime=-1),this.x!=t&&sign(this.x-t)!=this.facing&&(this.vX=0)}renderCharacter(t){t.scale(this.facing*this.facingScale,1);if(t.fillStyle="#000",t.wrap(()=>{if(this.walking&&t.rotate(sin(this.clock*PI*2/.25)*PI/32),this.clock<this.jumpStartTime+this.jumpPeakTime){let e=(this.clock-this.jumpStartTime)/this.jumpPeakTime;t.rotate(e*PI*2)}t.beginPath(),t.roundedRectangle(-13,-17,26,30,6),t.fill(),t.fillStyle="#daab79",t.fr(13,-11,-13,4),t.fillStyle="#000",t.fr(12,-10,-2,2),t.fr(8,-10,-2,2),t.fillStyle="#222",t.fr(-13,4,26,2)}),this.landed){let e=.5*sin(this.clock*PI*2/.25)+.5,i=this.walking?e:1,a=this.walking?1-e:1;t.fr(-8,11,4,6*i),t.fr(8,11,-4,6*a)}}render(){R.lineWidth=8,R.strokeStyle="#000",beginPath(),moveTo(this.bandanaTrail[0].x,this.bandanaTrail[0].y);let t=40;for(let e=1;e<this.bandanaTrail.length&&t>0;e++){let i=this.bandanaTrail[e],a=this.bandanaTrail[e-1],s=dist(i,a),l=min(s,t);t-=l;let r=l/s;lineTo(a.x+r*(i.x-a.x),a.y+r*(i.y-a.y))}stroke(),wrap(()=>{translate(this.x,this.y),this.renderCharacter(R)});R.strokeStyle="#f00",R.fillStyle="#f00",R.globalAlpha=.2,R.lineWidth=5,beginPath();for(let t=0;t<2*PI;t+=PI/16){let e=castRay(this.x,this.y,t,400);lineTo(e.x,e.y)}}}class Exit{constructor(t,e,i){this.level=t,this.x=e,this.y=i}cycle(t){this.level.player&&dist(this,this.level.player)<20&&this.level.foundExit()}render(){wrap(()=>{translate(this.x,this.y),drawImage(HALO,-HALO.width/2,-HALO.height/2),[G.clock*PI,-G.clock*PI/2,G.clock*PI/4].forEach(t=>{wrap(()=>{rotate(t),drawImage(GOD_RAY,-GOD_RAY.width/2,-GOD_RAY.height/2)})})});let t=COMPUTER.height+UNPADDED_DESK.height,e=toCellUnit(this.y);translate(this.x,40*(e+1)-t),drawImage(COMPUTER,-COMPUTER.width/2,0),drawImage(UNPADDED_DESK,-UNPADDED_DESK.width/2,COMPUTER.height)}}class Camera{constructor(t,e,i,a,s,l,r){this.level=t,this.x=e,this.y=i,this.cycleDescription=[[a,a,l],[a,s,r],[s,s,l],[s,a,r]];let h=0;this.cycleDescription.forEach(t=>{t.push(h),h+=t[2]}),this.totalCycleDuration=h}cycle(t){let e=this.level.clock%this.totalCycleDuration,i=this.cycleDescription.length-1;for(;this.cycleDescription[i][3]>e;)i--;let[a,s,l,r]=this.cycleDescription[i],h=(e-r)/l;this.angle=h*(s-a)+a,this.seesPlayer}get seesPlayer(){let t=normalize(angleBetween(this,this.level.player)),e=dist(this,this.level.player);if(abs(normalize(this.angle-t))>.4||e>400)return 0;{let i=castRay(this.x,this.y,t,400);return dist(this,i)>=e}}render(){let t=this.seesPlayer;renderVision(this.x,this.y,this.angle-.4,this.angle+.4,400,t?"#f00":"#ff0"),wrap(()=>{translate(this.x,this.y),rotate(this.angle),fs("#888"),fr(-10,-5,20,10),fs("#444"),fr(10,-2,4,4),fs(this.level.clock%2>1?"#f00":"#0f0"),fr(6,-3,2,2)})}}function SfxrParams(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var i=this.b+this.c+this.e;if(i<.18){var a=.18/i;this.b*=a,this.c*=a,this.e*=a}}}function SfxrSynth(){var t,e,i,a,s,l,r,h,n,o,c,d;this._params=new SfxrParams,this.resetManglable=function(){var t=this._params;a=100/(t.f*t.f+.001),s=100/(t.g*t.g+.001),l=1-t.h*t.h*t.h*.01,r=-t.i*t.i*t.i*1e-6,t.a||(c=.5-t.n/2,d=5e-5*-t.o),h=1+t.l*t.l*(t.l>0?-.9:10),n=0,o=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.resetManglable();var a=this._params;return t=a.b*a.b*1e5,e=a.c*a.c*1e5,i=a.e*a.e*1e5+12,3*((t+e+i)/3|0)},this.synthWave=function(f,p){var u=this._params,m=1!=u.s||u.v,y=u.v*u.v*.1,g=1+3e-4*u.w,x=u.s*u.s*u.s*.1,w=1+1e-4*u.t,v=1!=u.s,S=u.x*u.x,b=u.g,R=u.q||u.r,P=u.r*u.r*u.r*.2,T=u.q*u.q*(u.q<0?-1020:1020),k=u.p?32+((1-u.p)*(1-u.p)*2e4|0):0,C=u.d,A=u.j/2,O=u.k*u.k*.01,E=u.a,I=t,j=1/t,D=1/e,N=1/i,L=5/(1+u.u*u.u*20)*(.01+x);L>.8&&(L=.8),L=1-L;for(var G,W,B,M,U,z,H=0,Y=0,_=0,V=0,K=0,X=0,F=0,Q=0,q=0,J=0,Z=0,$=new Array(1024),tt=new Array(32),et=$.length;et--;)$[et]=0;for(et=tt.length;et--;)tt[et]=rnd(-1,1);for(et=0;et<p;et++){if(H)return et;if(k&&++J>=k&&(J=0,this.resetManglable()),o&&++n>=o&&(o=0,a*=h),(a*=l+=r)>s&&(a=s,b>0&&(H=1)),W=a,A>0&&(W*=1+sin(Z+=O)*A),(W|=0)<8&&(W=8),E||((c+=d)<0?c=0:c>.5&&(c=.5)),++_>I)switch(_=0,++Y){case 1:I=e;break;case 2:I=i}switch(Y){case 0:V=_*j;break;case 1:V=1+2*(1-_*D)*C;break;case 2:V=1-_*N;break;case 3:V=0,H=1}R&&((B=0|(T+=P))<0?B=-B:B>1023&&(B=1023)),m&&g&&((y*=g)<1e-5?y=1e-5:y>.1&&(y=.1)),z=0;for(var it=8;it--;){if(++Q>=W&&(Q%=W,3==E))for(var at=tt.length;at--;)tt[at]=rnd(-1,1);switch(E){case 0:U=Q/W<c?.5:-.5;break;case 1:U=1-Q/W*2;break;case 2:U=.225*(((U=1.27323954*(M=6.28318531*((M=Q/W)>.5?M-1:M))+.405284735*M*M*(M<0?1:-1))<0?-1:1)*U*U-U)+U;break;case 3:U=tt[abs(32*Q/W|0)]}m&&(G=F,(x*=w)<0?x=0:x>.1&&(x=.1),v?(X+=(U-F)*x,X*=L):(F=U,X=0),K+=(F+=X)-G,U=K*=1-y),R&&($[q%1024]=U,U+=$[(q-B+1024)%1024],q++),z+=U}z*=.125*V*S,f[et]=z>=1?32767:z<=-1?-32768:32767*z|0}return p}}var synth=new SfxrSynth,jsfxr=function(t){synth._params.setSettings(t);var e=synth.totalReset(),i=new Uint8Array(4*((e+1)/2|0)+44),a=2*synth.synthWave(new Uint16Array(i.buffer,44),e),s=new Uint32Array(i.buffer,0,44);s[0]=1179011410,s[1]=a+36,s[2]=1163280727,s[3]=544501094,s[4]=16,s[5]=65537,s[6]=44100,s[7]=88200,s[8]=1048578,s[9]=1635017060,s[10]=a,a+=44;for(var l=0,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="data:audio/wav;base64,";l<a;l+=3){var n=i[l]<<16|i[l+1]<<8|i[l+2];h+=r[n>>18]+r[n>>12&63]+r[n>>6&63]+r[63&n]}var o=new Audio;return o.src=h,o};jumpSound=jsfxr([0,,.1434,,.1212,.4471,,.2511,,,,,,.0426,,,,,.8862,,,,,.5]),hitSound=jsfxr([1,,.0713,,.1467,.5483,,-.4465,,,,,,,,,,,1,,,.0639,,.5]),pickupSound=jsfxr([0,,.0224,.441,.1886,.6932,,,,,,,,,,,,,1,,,,,.5]),spawnSound=jsfxr([2,.28,.45,,.56,.35,,.4088,,,,,.03,.1557,,.5565,-.02,-.02,1,,,,,.5]),explosionSound=jsfxr([3,,.244,.6411,.2242,.7416,,-.2717,,,,.0171,.0346,,,,-.0305,.0244,1,,,.0275,-.0076,.5]),menuSound=jsfxr([0,,.1394,,.0864,.48,,,,,,,,.5326,,,,,1,,,.1,,.5]),saySound=jsfxr([2,.03,.1,.14,.25,.54,.3167,-.02,.3999,,.05,,,.1021,.0684,,.1287,-.1816,1,,,,,.46]),landSound=jsfxr([3,,.0118,.03,.1681,.565,,-.2343,,,,.26,.6855,,,,,,1,,,,,.2]),fixedSound=jsfxr([0,,.2098,,.4725,.3665,,.1895,,,,,,.0067,,.5437,,,1,,,,,.45]),w.down={},onkeydown=(t=>{w.down[t.keyCode]=1}),onkeyup=(t=>{w.down[t.keyCode]=0});class Game{constructor(){(G=this).clock=0,this.level=LEVELS[0],this.level.start(),this.altitude=0,this.centerLevel(this.level)}cycle(t){this.clock+=t,this.level.cycle(t),INTERPOLATIONS.slice().forEach(e=>e.cycle(t)),this.render()}centerLevel(t){interp(this,"altitude",this.altitude,this.levelY(t)-0,.5)}levelY(t){return 800-800*t.index-0-800}render(){R.fillStyle=SKY_BACKGROUND,fr(0,0,1600,800),R.fillStyle="#fff",beginPath(),arc(1400,100,50,0,2*PI,1),fill(),wrap(()=>{translate(0,-this.altitude),R.fillStyle="#000",fr(400,0,800,800);let t=LEVELS.indexOf(this.level);for(let e=max(0,t-1);e<min(LEVELS.length,t+2);e++)wrap(()=>{translate(400,this.levelY(LEVELS[e])),LEVELS[e].render()})})}}onload=(()=>{onresize(),CANVAS.width=1600,CANVAS.height=800,R=CANVAS.getContext("2d"),Object.getOwnPropertyNames(canvasProto).forEach(t=>{R[t].call&&(w[t]=canvasProto[t].bind(R))}),console.log("LOADED"),new Game;let t=Date.now(),e=()=>{let i=Date.now(),a=min((i-t)/1e3,100);t=i,G.cycle(a),requestAnimationFrame(e)};e()});</script>